<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Estoque</title>
    <style>
        h2 {
            color: red;
            padding-left: 30%;
            padding-right: auto;
        }
        body {
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            margin: 20px;
            background-color: rgb(0, 0, 0);
        }
        .container {
            max-width: 600px;
            margin: auto;            
        }
        input[type="text"], [type="number"] {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            box-sizing: border-box;
        }
        button {
            padding: 10px 20px;          
            background-color: rgb(168, 18, 18);
            color: white;
            border: none;
            cursor: pointer;
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            font-size: 18px;
            margin-right: 10px;
        }
        button:hover {
            background-color: green;
        }
        .product-list {
            margin-top: 20px;
            color: white;
            padding-left: 15px;
        }
        .product-item {
            padding: 10px;
            border-bottom: 1px solid white;
            display: inline-flex;
            justify-content: space-between;
            align-items: center;
        }
        .product-item button {
            background-color: red;
        }
        .product-item button.edit-btn {
            background-color: rgb(0, 102, 255);
        }
        .sales-list {
            margin-top: 20px;
            color: white;
            padding-left: 15px;
        }
        .sale-item {
            padding: 10px;
            border-bottom: 1px solid white;
        }
        .dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border: 1px solid black;
            z-index: 1000;
        }
        .dialog button {
            margin-top: 10px;
            padding: 8px 16px;
            background-color: #008000;
            color: white;
            border: none;
            cursor: pointer;
        }
        .dialog button.cancel {
            background-color: #FF0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Gestor de Estoque</h2>
        <input type="text" id="nomeProduto" placeholder="Nome do Produto">
        <input type="number" id="valorProduto" placeholder="Valor">
        <input type="number" id="quantidadeProduto" placeholder="Quantidade">
        <br>
        <button onclick="adicionarProduto()">Adicionar Produto</button>
        <button onclick="calcularTotal()">Total Agregado</button>
        <button onclick="abrirDialogo()">Registrar Venda</button>
        <p id="resultado" style="color: grey;"></p>
        <div class="product-list" id="listaProdutos">
            <!-- Lista de Produtos será preenchida dinamicamente -->
        </div>

        <h2>Registro de Vendas</h2>
        <div id="registroVendas" class="sales-list">
            <!-- Lista de vendas será preenchida dinamicamente -->
        </div>

    </div>

    <div id="dialogo" class="dialog">
        <p>Selecione o produto e quantidade vendida:</p>
        <select id="selectProduto">
            <!-- Options serão preenchidos dinamicamente -->
        </select>
        <input type="number" id="quantidadeVendida" placeholder="Quantidade Vendida">
        <button onclick="registrarVenda()">Registrar Venda</button>
        <button class="cancel" onclick="fecharDialogo()">Cancelar</button>
    </div>

    <script>
        let produtos = [];
        let vendas = [];

        // Carregar produtos e vendas salvos ao carregar a página
        document.addEventListener('DOMContentLoaded', () => {
            let produtosSalvos = localStorage.getItem('produtos');
            if (produtosSalvos) {
                produtos = JSON.parse(produtosSalvos);
                exibirProdutos();
            }

            let vendasSalvas = localStorage.getItem('vendas');
            if (vendasSalvas) {
                vendas = JSON.parse(vendasSalvas);
                exibirVendas();
            }

            // Preencher select de produtos no diálogo de venda
            let selectProduto = document.getElementById('selectProduto');
            produtos.forEach(produto => {
                let option = document.createElement('option');
                option.value = produto.nome;
                option.innerText = produto.nome;
                selectProduto.appendChild(option);
            });
        });

        function salvarProdutos() {
            localStorage.setItem('produtos', JSON.stringify(produtos));
        }

        function salvarVendas() {
            localStorage.setItem('vendas', JSON.stringify(vendas));
        }

        function adicionarProduto() {
            let nome = document.getElementById('nomeProduto').value;
            let valor = parseFloat(document.getElementById('valorProduto').value);
            let quantidade = parseInt(document.getElementById('quantidadeProduto').value);

            if (nome && !isNaN(valor) && !isNaN(quantidade)) {
                let id = produtos.length + 1; // Gera um ID simples para o produto
                produtos.push({ id, nome, valor, quantidade });
                salvarProdutos(); // Salvar no localStorage
                exibirProdutos();
                document.getElementById('nomeProduto').value = '';
                document.getElementById('valorProduto').value = '';
                document.getElementById('quantidadeProduto').value = '';
                document.getElementById('resultado').innerText = 'Produto adicionado com sucesso!';
                document.getElementById('resultado').style.color = '#008000';
            } else {
                document.getElementById('resultado').innerText = 'Por favor, preencha todos os campos CORRETAMENTE.';
                document.getElementById('resultado').style.color = '#FF0000';
            }
        }

        function exibirProdutos() {
            let listaProdutos = document.getElementById('listaProdutos');
            listaProdutos.innerHTML = '';
            produtos.forEach(produto => {
                let item = document.createElement('div');
                item.classList.add('product-item');
                item.innerHTML = `
                    <span>${produto.nome}: R$${produto.valor.toFixed(2)} x ${produto.quantidade}</span>
                    <button class="edit-btn" onclick="editarProduto(${produto.id})">Editar</button>
                    <button onclick="abrirDialogoRemover(${produto.id})">Remover</button>
                `;
                listaProdutos.appendChild(item);
            }); 
        }

        function editarProduto(id) {
            let produto = produtos.find(p => p.id === id);
            if (produto) {
                document.getElementById('nomeProduto').value = produto.nome;
                document.getElementById('valorProduto').value = produto.valor.toFixed(2);
                document.getElementById('quantidadeProduto').value = produto.quantidade;
                produtos = produtos.filter(p => p.id !== id); // Remove o produto da lista temporária
                salvarProdutos(); // Salvar no localStorage
                exibirProdutos(); // Atualiza a exibição da lista sem o produto editando
            }
        }

        function abrirDialogoRemover(id) {
            let dialogo = document.getElementById('dialogo');
            dialogo.dataset.produtoId = id;
            dialogo.style.display = 'block';
        }

        function confirmarRemocao() {
            let id = document.getElementById('dialogo').dataset.produtoId;
            produtos = produtos.filter(p => p.id != id);
            salvarProdutos(); // Salvar no localStorage
            exibirProdutos(); // Atualizar a lista de produtos
            fecharDialogo();
        }

        function fecharDialogo() {
            document.getElementById('dialogo').style.display = 'none';
        }

        function calcularTotal() {
            let total = produtos.reduce((acc, prod) => acc + (prod.valor * prod.quantidade), 0);
            document.getElementById('resultado').innerText = `Total agregado: R$${total.toFixed(2)}`;
            document.getElementById('resultado').style.color = '#2196F3';
        }

        function abrirDialogo() {
            let dialogo = document.getElementById('dialogo');
            dialogo.style.display = 'block';
        }

        function registrarVenda() {
            let nome = document.getElementById('selectProduto').value;
            let quantidade = parseInt(document.getElementById('quantidadeVendida').value);

            let produto = produtos.find(p => p.nome === nome);
            if (produto && quantidade > 0 && quantidade <= produto.quantidade) {
                produto.quantidade -= quantidade;
                salvarProdutos(); // Atualiza quantidade de produtos em estoque

                let vendaExistente = vendas.find(v => v.nome === nome);
                if (vendaExistente) {
                    vendaExistente.quantidade += quantidade;
                } else {
                    vendas.push({ nome, quantidade });
                }
                salvarVendas(); // Salvar vendas no localStorage

                exibirProdutos();
                exibirVendas();
                document.getElementById('resultado').innerText = `Venda registrada: ${quantidade} unidades de ${nome}`;
                document.getElementById('resultado').style.color = '#008000';
            } else {
                document.getElementById('resultado').innerText = 'Por favor, selecione um produto e insira uma quantidade válida.';
                document.getElementById('resultado').style.color = '#FF0000';
            }

            fecharDialogo();
        }

        function exibirVendas() {
            let registroVendas = document.getElementById('registroVendas');
            registroVendas.innerHTML = '<h3>Produtos Vendidos</h3>';
            vendas.forEach(venda => {
                let item = document.createElement('div');
                item.classList.add('sale-item');
                item.innerHTML = `${venda.nome}: ${venda.quantidade} unidades`;
                registroVendas.appendChild(item);
            });
        }
    </script>
</body>
</html>
