<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Estoque</title>
    <style>
        h2 {
            color: red;
            padding-left: 30%;
            padding-right: auto;
        }
        body {
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            margin: 20px;
            background-color: rgb(0, 0, 0);
        }
        .container {
            max-width: 600px;
            margin: auto;            
        }
        input[type="text"], [type="number"] {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            box-sizing: border-box;
        }
        button {
            padding: 10px 20px;          
            background-color: rgb(168, 18, 18);
            color: white;
            border: none;
            cursor: pointer;
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            font-size: 18px;
            margin-right: 10px;
        }
        button:hover {
            background-color: green;
        }
        .product-list, .sales-list {
            margin-top: 20px;
            color: white;
            padding-left: 15px;
        }
        .product-item, .sale-item {
            padding: 10px;
            border-bottom: 1px solid white;
            display: inline-flex;
            justify-content: space-between;
            align-items: center;
        }
        .product-item button, .sale-item button {
            background-color: red;
        }
        .product-item button.edit-btn, .sale-item button.edit-btn {
            background-color: rgb(0, 102, 255);
        }
        .dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border: 1px solid black;
            z-index: 1000;
        }
        .dialog button {
            margin-top: 10px;
            padding: 8px 16px;
            background-color: #008000;
            color: white;
            border: none;
            cursor: pointer;
        }
        .dialog button.cancel {
            background-color: #FF0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Gestor de Estoque</h2>
        <input type="text" id="nomeProduto" placeholder="Nome do Produto">
        <input type="number" id="valorProduto" placeholder="Valor">
        <input type="number" id="quantidadeProduto" placeholder="Quantidade">
        <br>
        <button onclick="adicionarProduto()">Adicionar Produto</button>
        <button onclick="calcularTotal()">Total Agregado</button>
        <button onclick="abrirDialogo()">Registrar Venda</button>
        <p id="resultado" style="color: grey;"></p>
        <div class="product-list" id="listaProdutos">
            <!-- Lista de Produtos será preenchida dinamicamente -->
        </div>

        <h2>Registro de Vendas</h2>
        <div id="registroVendas" class="sales-list">
            <!-- Lista de vendas será preenchida dinamicamente -->
        </div>

    </div>

    <!-- Diálogo para Registrar Venda -->
    <div id="dialogo" class="dialog">
        <p>Selecione o produto e quantidade vendida:</p>
        <select id="selectProduto">
            <!-- Options serão preenchidos dinamicamente -->
        </select>
        <input type="number" id="quantidadeVendida" placeholder="Quantidade Vendida">
        <button onclick="registrarVenda()">Registrar Venda</button>
        <button class="cancel" onclick="fecharDialogo()">Cancelar</button>
    </div>

    <!-- Diálogo para Remover Produto -->
    <div id="dialogoRemoverProduto" class="dialog">
        <p>Você deseja remover este produto?</p>
        <button onclick="confirmarRemocaoProduto()">Sim</button>
        <button class="cancel" onclick="fecharDialogoRemoverProduto()">Cancelar</button>
    </div>

    <!-- Diálogo para Remover Venda -->
    <div id="dialogoRemoverVenda" class="dialog">
        <p>Você deseja remover esta venda?</p>
        <button onclick="confirmarRemocaoVenda()">Sim</button>
        <button class="cancel" onclick="fecharDialogoRemoverVenda()">Cancelar</button>
    </div>

    <!-- Diálogo para Editar Venda -->
    <div id="dialogoEditarVenda" class="dialog">
        <p>Editar quantidade da venda:</p>
        <input type="number" id="novaQuantidadeVenda" placeholder="Nova Quantidade">
        <button onclick="editarVenda()">Salvar</button>
        <button class="cancel" onclick="fecharDialogoEditarVenda()">Cancelar</button>
    </div>

    <script>
        let produtos = [];
        let vendas = [];

        // Carregar produtos e vendas salvos ao carregar a página
        document.addEventListener('DOMContentLoaded', () => {
            let produtosSalvos = localStorage.getItem('produtos');
            if (produtosSalvos) {
                produtos = JSON.parse(produtosSalvos);
                exibirProdutos();
            }

            let vendasSalvas = localStorage.getItem('vendas');
            if (vendasSalvas) {
                vendas = JSON.parse(vendasSalvas);
                exibirVendas();
            }

            // Preencher select de produtos no diálogo de venda
            let selectProduto = document.getElementById('selectProduto');
            produtos.forEach(produto => {
                let option = document.createElement('option');
                option.value = produto.nome;
                option.innerText = produto.nome;
                selectProduto.appendChild(option);
            });
        });

        function salvarProdutos() {
            localStorage.setItem('produtos', JSON.stringify(produtos));
        }

        function salvarVendas() {
            localStorage.setItem('vendas', JSON.stringify(vendas));
        }

        function adicionarProduto() {
            let nome = document.getElementById('nomeProduto').value;
            let valor = parseFloat(document.getElementById('valorProduto').value);
            let quantidade = parseInt(document.getElementById('quantidadeProduto').value);

            if (nome && !isNaN(valor) && !isNaN(quantidade)) {
                // Verifica se o produto já existe na lista
                let produtoExistente = produtos.find(p => p.nome === nome);
                if (produtoExistente) {
                    // Se existir, apenas soma a quantidade
                    produtoExistente.quantidade += quantidade;
                    salvarProdutos(); // Salvar no localStorage
                    exibirProdutos(); // Atualizar a exibição dos produtos
                    document.getElementById('resultado').innerText = `Quantidade de ${nome} atualizada para ${produtoExistente.quantidade}`;
                    document.getElementById('resultado').style.color = '#008000';
                } else {
                    // Se não existir, adiciona um novo produto
                    let id = produtos.length + 1; // Gera um ID simples para o produto
                    produtos.push({ id, nome, valor, quantidade });
                    salvarProdutos(); // Salvar no localStorage
                    exibirProdutos(); // Atualizar a exibição dos produtos
                    document.getElementById('resultado').innerText = 'Produto adicionado com sucesso!';
                    document.getElementById('resultado').style.color = '#008000';
                }

                document.getElementById('nomeProduto').value = '';
                document.getElementById('valorProduto').value = '';
                document.getElementById('quantidadeProduto').value = '';
            } else {
                document.getElementById('resultado').innerText = 'Por favor, preencha todos os campos CORRETAMENTE.';
                document.getElementById('resultado').style.color = '#FF0000';
            }
        }

        function exibirProdutos() {
            let listaProdutos = document.getElementById('listaProdutos');
            listaProdutos.innerHTML = '';
            produtos.forEach(produto => {
                let item = document.createElement('div');
                item.classList.add('product-item');
                item.innerHTML = `
                    <span>${produto.nome}: R$${produto.valor.toFixed(2)} x ${produto.quantidade}</span>
                    <button class="edit-btn" onclick="editarProduto(${produto.id})">Editar</button>
                    <button onclick="abrirDialogoRemoverProduto(${produto.id})">Remover</button>
                `;
                listaProdutos.appendChild(item);
            }); 
        }

        function editarProduto(id) {
            let produto = produtos.find(p => p.id === id);
            if (produto) {
                document.getElementById('nomeProduto').value = produto.nome;
                document.getElementById('valorProduto').value = produto.valor.toFixed(2);
                document.getElementById('quantidadeProduto').value = produto.quantidade;
                produtos = produtos.filter(p => p.id !== id); // Remove o produto da lista temporária
                salvarProdutos(); // Salvar no localStorage
                exibirProdutos(); // Atualiza a exibição da lista sem o produto editando
            }
        }

        function abrirDialogoRemoverProduto(id) {
            let dialogoRemoverProduto = document.getElementById('dialogoRemoverProduto');
            dialogoRemoverProduto.dataset.produtoId = id;
            dialogoRemoverProduto.style.display = 'block';
        }

        function fecharDialogoRemoverProduto() {
            document.getElementById('dialogoRemoverProduto').style.display = 'none';
        }

        function confirmarRemocaoProduto() {
            let id = document.getElementById('dialogoRemoverProduto').dataset.produtoId;
            produtos = produtos.filter(p => p.id !== parseInt(id));
            salvarProdutos(); // Salvar no localStorage
            exibirProdutos();
            fecharDialogoRemoverProduto();
        }

        function calcularTotal() {
            let total = produtos.reduce((acc, prod) => acc + (prod.valor * prod.quantidade), 0);
            document.getElementById('resultado').innerText = `Total agregado: R$${total.toFixed(2)}`;
            document.getElementById('resultado').style.color = '#2196F3';
        }

        function abrirDialogo() {
            document.getElementById('dialogo').style.display = 'block';
        }

        function fecharDialogo() {
            document.getElementById('dialogo').style.display = 'none';
        }

        function registrarVenda() {
            let nome = document.getElementById('selectProduto').value;
            let quantidade = parseInt(document.getElementById('quantidadeVendida').value);

            if (nome && !isNaN(quantidade)) {
                let produto = produtos.find(p => p.nome === nome);
                if (produto && produto.quantidade >= quantidade) {
                    produto.quantidade -= quantidade;
                    salvarProdutos(); // Salvar no localStorage

                    // Registrar a venda
                    let vendaExistente = vendas.find(v => v.nome === nome);
                    if (vendaExistente) {
                        vendaExistente.quantidade += quantidade;
                    } else {
                        vendas.push({ nome, quantidade });
                    }
                    salvarVendas(); // Salvar no localStorage

                    exibirProdutos();
                    exibirVendas();
                    document.getElementById('resultado').innerText = `Venda registrada: ${quantidade} unidades de ${nome}`;
                    document.getElementById('resultado').style.color = '#008000';
                } else {
                    document.getElementById('resultado').innerText = 'Quantidade insuficiente em estoque.';
                    document.getElementById('resultado').style.color = '#FF0000';
                }
            } else {
                document.getElementById('resultado').innerText = 'Por favor, selecione um produto e insira uma quantidade válida.';
                document.getElementById('resultado').style.color = '#FF0000';
            }

            fecharDialogo();
        }

        function exibirVendas() {
            let registroVendas = document.getElementById('registroVendas');
            registroVendas.innerHTML = '<h3>Produtos Vendidos</h3>';
            vendas.forEach(venda => {
                let item = document.createElement('div');
                item.classList.add('sale-item');
                item.innerHTML = `
                    <span>${venda.nome}: ${venda.quantidade} unidades</span>
                    <button class="edit-btn" onclick="abrirDialogoEditarVenda('${venda.nome}')">Editar</button>
                    <button onclick="abrirDialogoRemoverVenda('${venda.nome}')">Remover</button>
                `;
                registroVendas.appendChild(item);
            });
        }

        function abrirDialogoEditarVenda(nome) {
            let dialogoEditarVenda = document.getElementById('dialogoEditarVenda');
            dialogoEditarVenda.dataset.vendaNome = nome;
            dialogoEditarVenda.style.display = 'block';
        }

        function fecharDialogoEditarVenda() {
            document.getElementById('dialogoEditarVenda').style.display = 'none';
        }

        function editarVenda() {
            let nome = document.getElementById('dialogoEditarVenda').dataset.vendaNome;
            let novaQuantidade = parseInt(document.getElementById('novaQuantidadeVenda').value);

            if (nome && !isNaN(novaQuantidade)) {
                let venda = vendas.find(v => v.nome === nome);
                if (venda) {
                    venda.quantidade = novaQuantidade;
                    salvarVendas(); // Salvar no localStorage
                    exibirVendas();
                    document.getElementById('resultado').innerText = `Venda de ${nome} atualizada para ${novaQuantidade} unidades.`;
                    document.getElementById('resultado').style.color = '#008000';
                }
            }

            fecharDialogoEditarVenda();
        }

        function abrirDialogoRemoverVenda(nome) {
            let dialogoRemoverVenda = document.getElementById('dialogoRemoverVenda');
            dialogoRemoverVenda.dataset.vendaNome = nome;
            dialogoRemoverVenda.style.display = 'block';
        }

        function fecharDialogoRemoverVenda() {
            document.getElementById('dialogoRemoverVenda').style.display = 'none';
        }

        function confirmarRemocaoVenda() {
            let nome = document.getElementById('dialogoRemoverVenda').dataset.vendaNome;
            vendas = vendas.filter(v => v.nome !== nome);
            salvarVendas(); // Salvar no localStorage
            exibirVendas();
            fecharDialogoRemoverVenda();
        }
    </script>
</body>
</html>
